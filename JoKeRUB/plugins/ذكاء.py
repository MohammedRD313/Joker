import pytgpt.phind
import requests
import asyncio
import os
import sys
import urllib.request
from datetime import timedelta
from telethon import events
from telethon.errors import FloodWaitError
from telethon.tl.functions.messages import GetHistoryRequest, ImportChatInviteRequest
from telethon.tl.functions.channels import JoinChannelRequest
from telethon.errors.rpcerrorlist import YouBlockedUserError
from telethon.tl.functions.contacts import UnblockRequest as unblock
from telethon.tl.functions.messages import ImportChatInviteRequest as Get

from JoKeRUB import l313l
from . import l313l
from ..Config import Config
from ..core.managers import edit_delete, edit_or_reply
from ..helpers.utils import reply_id

plugin_category = "Ø§Ù„Ø¨ÙˆØª"

# Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØª Ø¬Ø¯ÙŠØ¯ Ù…Ù† pytgpt.phind
bot = pytgpt.phind.PHIND()

def gpt(message):
    return bot.chat(f'{message}')

@l313l.ar_cmd(pattern="Ø³Ø¤Ø§Ù„(?: |$)(.*)")
async def zelzal_gpt(event):
    zilzal = event.pattern_match.group(1)
    zzz = await event.get_reply_message()
    if not zilzal and not event.reply_to_msg_id:
        return await edit_or_reply(event, "**âœâ”Šâ€Œ Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ùˆ Ø¨Ø£Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ \n ÙŠØ¹Ù†ÙŠ ØªÙƒØªØ¨ (`.Ø³Ø¤Ø§Ù„`) ÙˆØ¨Ø¹Ø¯Ù‡ Ø³Ø¤Ø§Ù„Ùƒ ÙˆØ®Ù„Øµ ğŸ˜Œ \n\n Ù…Ø«Ø§Ù„ : \n `.Ø³Ø¤Ø§Ù„ Ù…Ù† Ù‡Ùˆ Ù…Ø®ØªØ±Ø¹ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡`**")
    if not zilzal and event.reply_to_msg_id and zzz.text:
        zilzal = zzz.text
    if not event.reply_to_msg_id:
        zilzal = event.pattern_match.group(1)

    zed = await edit_or_reply(event, "**âœâ”Šâ€Œ Ø§ØµØ¨Ø± Ø­Ø¨ÙŠØ¨ÙŠ Ù‡Ø³Ø© ÙŠØ¬Ø§ÙˆØ¨Ùƒ ğŸ˜**")

    try:
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        response = gpt(zilzal)
        await asyncio.sleep(5)
        malath = response
        
        if "Please wait another 8 seconds" in malath:
            await zed.delete()
            return await borg.send_message(event.chat_id, "**âœâ”Šâ€Œ Ø§ØµØ¨Ø± Ø­Ø¨ÙŠØ¨ÙŠ Ù‡Ø³Ø© ÙŠØ¬Ø§ÙˆØ¨Ùƒ ğŸ˜**")
        
        if "understanding" in malath:
            await zed.delete()
            return await borg.send_message(event.chat_id, "**- Ø¹Ù€Ø°Ø±Ù‹Ø§ .. Ù„Ù… Ø£ÙÙ‡Ù… Ø³Ø¤Ø§Ù„Ùƒ\n- Ù‚Ù… Ø¨Ù€ Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØªÙ‡ Ù…Ù† ÙØ¶Ù„ÙƒØŸ!**")
        
        await zed.delete()
        await borg.send_message(event.chat_id, f"**Ø§Ù„Ø³Ø¤Ø§Ù„ : {zilzal}\n\n{malath}**\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n")

    except Exception as e:
        await zed.delete()
        await borg.send_message(event.chat_id, f"**Ø­Ø¯Ø« Ø®Ø·Ø£: {str(e)}**")
